---
openapi: 3.0.3
info:
  title: object-controller API
  version: 0.2.0-SNAPSHOT
servers:
- url: http://localhost:8080
  description: Auto generated value
- url: http://0.0.0.0:8080
  description: Auto generated value
paths:
  /api/classes:
    get:
      parameters:
      - name: limit
        in: query
        schema:
          format: int32
          type: integer
      - name: offset
        in: query
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginationOaasClass'
    post:
      parameters:
      - name: update
        in: query
        schema:
          default: false
          type: boolean
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OaasClass'
          text/x-yaml:
            schema:
              type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OaasClass'
  /api/classes/{name}:
    get:
      parameters:
      - name: name
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OaasClass'
    delete:
      parameters:
      - name: name
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OaasClass'
    patch:
      parameters:
      - name: name
        in: path
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OaasClass'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OaasClass'
  /api/classes/{name}/objects:
    get:
      parameters:
      - name: name
        in: path
        required: true
        schema:
          type: string
      - name: limit
        in: query
        schema:
          format: int32
          type: integer
      - name: offset
        in: query
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginationOaasObject'
  /api/functions:
    get:
      parameters:
      - name: limit
        in: query
        schema:
          format: int32
          type: integer
      - name: offset
        in: query
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginationOaasFunction'
    post:
      parameters:
      - name: update
        in: query
        schema:
          default: false
          type: boolean
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/OaasFunction'
          text/x-yaml:
            schema:
              type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OaasFunction'
  /api/functions/{funcName}:
    get:
      parameters:
      - name: funcName
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OaasFunction'
  /api/modules:
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Module'
          text/x-yaml:
            schema:
              type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Module'
  /api/object-construct:
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ObjectConstructRequest'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ObjectConstructResponse'
  /api/objects:
    get:
      parameters:
      - name: limit
        in: query
        schema:
          format: int32
          type: integer
      - name: offset
        in: query
        schema:
          format: int32
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginationOaasObject'
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OaasObject'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OaasObject'
      deprecated: true
  /api/objects/{id}:
    get:
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OaasObject'
components:
  schemas:
    FunctionAccessModifier:
      enum:
      - INTERNAL
      - PRIVATE
      - PUBLIC
      type: string
    JobProvisionConfig:
      type: object
      properties:
        argsToEnv:
          type: boolean
        commands:
          type: array
          items:
            type: string
        containerArgs:
          type: array
          items:
            type: string
        image:
          type: string
        limitsCpu:
          type: string
        limitsMemory:
          type: string
        requestsCpu:
          type: string
        requestsMemory:
          type: string
      deprecated: true
    KeyAccessModifier:
      enum:
      - INTERNAL
      - PRIVATE
      - PUBLIC
      type: string
    KeySpecification:
      type: object
      properties:
        access:
          $ref: '#/components/schemas/KeyAccessModifier'
        name:
          type: string
        provider:
          type: string
    KnativeProvision:
      type: object
      properties:
        concurrency:
          format: int32
          type: integer
        env:
          type: object
          additionalProperties:
            type: string
        image:
          type: string
        limitsCpu:
          type: string
        limitsMemory:
          type: string
        maxScale:
          format: int32
          type: integer
        minScale:
          format: int32
          type: integer
        requestsCpu:
          type: string
        requestsMemory:
          type: string
        scaleDownDelay:
          type: string
    Module:
      type: object
      properties:
        classes:
          type: array
          items:
            $ref: '#/components/schemas/OaasClass'
        functions:
          type: array
          items:
            $ref: '#/components/schemas/OaasFunction'
    OaasClass:
      type: object
      properties:
        functions:
          uniqueItems: true
          type: array
          items:
            $ref: '#/components/schemas/OaasFunctionBinding'
        genericType:
          type: string
        name:
          type: string
        objectType:
          $ref: '#/components/schemas/ObjectType'
        parents:
          uniqueItems: true
          type: array
          items:
            type: string
        refSpec:
          uniqueItems: true
          type: array
          items:
            $ref: '#/components/schemas/ReferenceSpecification'
        stateSpec:
          $ref: '#/components/schemas/StateSpecification'
        stateType:
          $ref: '#/components/schemas/StateType'
    OaasDataflow:
      type: object
      properties:
        export:
          type: string
        exports:
          uniqueItems: true
          type: array
          items:
            $ref: '#/components/schemas/OaasWorkflowExport'
        steps:
          type: array
          items:
            $ref: '#/components/schemas/OaasDataflowStep'
    OaasDataflowStep:
      type: object
      properties:
        argRefs:
          type: object
          additionalProperties:
            type: string
        args:
          type: object
          additionalProperties:
            type: string
        as:
          type: string
        funcName:
          type: string
        inputRefs:
          type: array
          items:
            type: string
        target:
          type: string
    OaasFunction:
      required:
      - name
      - type
      type: object
      properties:
        macro:
          $ref: '#/components/schemas/OaasDataflow'
        name:
          pattern: \S
          type: string
        outputCls:
          type: string
        provision:
          $ref: '#/components/schemas/ProvisionConfig'
        type:
          $ref: '#/components/schemas/OaasFunctionType'
        validation:
          $ref: '#/components/schemas/OaasFunctionValidation'
    OaasFunctionBinding:
      type: object
      properties:
        access:
          $ref: '#/components/schemas/FunctionAccessModifier'
        defaultArgs:
          type: object
          additionalProperties:
            type: string
        forwardRecords:
          uniqueItems: true
          type: array
          items:
            type: string
        function:
          type: string
        name:
          type: string
    OaasFunctionType:
      enum:
      - LOGICAL
      - MACRO
      - TASK
      type: string
    OaasFunctionValidation:
      type: object
      properties:
        bindingRequirement:
          $ref: '#/components/schemas/ObjectRequirement'
        inputs:
          type: array
          items:
            $ref: '#/components/schemas/ObjectRequirement'
    OaasObject:
      type: object
      properties:
        cls:
          type: string
        embeddedRecord:
          type: string
        id:
          type: string
        labels:
          uniqueItems: true
          type: array
          items:
            type: string
        origin:
          $ref: '#/components/schemas/ObjectOrigin'
        originHash:
          format: int64
          type: integer
        refs:
          uniqueItems: true
          type: array
          items:
            $ref: '#/components/schemas/ObjectReference'
        state:
          $ref: '#/components/schemas/OaasObjectState'
        status:
          $ref: '#/components/schemas/ObjectStatus'
        streamInfo:
          $ref: '#/components/schemas/StreamInfo'
    OaasObjectState:
      type: object
      properties:
        overrideUrls:
          type: object
          additionalProperties:
            type: string
        stateId:
          type: string
    OaasWorkflowExport:
      type: object
      properties:
        as:
          type: string
        from:
          type: string
    ObjectConstructRequest:
      type: object
      properties:
        cls:
          type: string
        embeddedRecord:
          type: string
        keys:
          uniqueItems: true
          type: array
          items:
            type: string
        labels:
          uniqueItems: true
          type: array
          items:
            type: string
        members:
          uniqueItems: true
          type: array
          items:
            $ref: '#/components/schemas/ObjectReference'
        overrideUrls:
          type: object
          additionalProperties:
            type: string
        streamConstructs:
          type: array
          items:
            $ref: '#/components/schemas/ObjectConstructRequest'
    ObjectConstructResponse:
      type: object
      properties:
        object:
          $ref: '#/components/schemas/OaasObject'
        streams:
          type: array
          items:
            $ref: '#/components/schemas/ObjectConstructResponse'
        uploadUrls:
          type: object
          additionalProperties:
            type: string
    ObjectOrigin:
      type: object
      properties:
        args:
          type: object
          additionalProperties:
            type: string
        funcName:
          type: string
        inputs:
          type: array
          items:
            type: string
        parentId:
          type: string
    ObjectReference:
      type: object
      properties:
        name:
          type: string
        objId:
          type: string
    ObjectRequirement:
      type: object
      properties:
        cls:
          type: string
        labels:
          uniqueItems: true
          type: array
          items:
            type: string
    ObjectStatus:
      type: object
      properties:
        completedTime:
          format: int64
          type: integer
        createdTime:
          format: int64
          type: integer
        errorMsg:
          type: string
        submittedTime:
          format: int64
          type: integer
        taskStatus:
          $ref: '#/components/schemas/TaskStatus'
        waitFor:
          type: array
          items:
            type: string
    ObjectType:
      enum:
      - COMPOUND
      - SIMPLE
      - STREAM
      type: string
    PaginationOaasClass:
      type: object
      properties:
        itemCount:
          format: int64
          type: integer
        items:
          type: array
          items:
            $ref: '#/components/schemas/OaasClass'
        offset:
          format: int64
          type: integer
        total:
          format: int64
          type: integer
    PaginationOaasFunction:
      type: object
      properties:
        itemCount:
          format: int64
          type: integer
        items:
          type: array
          items:
            $ref: '#/components/schemas/OaasFunction'
        offset:
          format: int64
          type: integer
        total:
          format: int64
          type: integer
    PaginationOaasObject:
      type: object
      properties:
        itemCount:
          format: int64
          type: integer
        items:
          type: array
          items:
            $ref: '#/components/schemas/OaasObject'
        offset:
          format: int64
          type: integer
        total:
          format: int64
          type: integer
    ProvisionConfig:
      type: object
      properties:
        job:
          $ref: '#/components/schemas/JobProvisionConfig'
        knative:
          $ref: '#/components/schemas/KnativeProvision'
        type:
          $ref: '#/components/schemas/Type'
    ReferenceSpecification:
      type: object
      properties:
        cls:
          type: string
        internal:
          type: boolean
        name:
          type: string
    StateSpecification:
      type: object
      properties:
        defaultProvider:
          type: string
        keySpecs:
          type: array
          items:
            $ref: '#/components/schemas/KeySpecification'
    StateType:
      enum:
      - COLLECTION
      - FILES
      type: string
    StreamInfo:
      type: object
      properties:
        count:
          format: int32
          type: integer
    TaskStatus:
      enum:
      - DEPENDENCY_FAILED
      - DOING
      - FAILED
      - LAZY
      - READY
      - SUCCEEDED
      type: string
    Type:
      enum:
      - DURABLE
      - EPHEMERAL
      type: string
