- name: buildin.hls.ts.transcode
  type: TASK
  reactive: true
  outputTemplate:
    type: RESOURCE
    labels: {}
    state:
      type: STREAM_FILES
  bindingRequirement:
    requiredType: RESOURCE
    requiredStateType: STREAM_FILES
  additionalInputs: []
  task:
    type: EPHEMERAL_WORKER
    image: jrottenberg/ffmpeg:4.1-alpine
    commands:
      - /bin/sh
      - '-c'
    containerArgs:
      - |
        ffprobe $MAIN_RESOURCE_URL/$REQUEST_FILE
    argsToEnv: true

- name: buildin.hls.macro.transcode
  type: MACRO
  reactive: true
  outputTemplate:
    type: COMPOUND
    labels: {}
  bindingRequirement:
    requiredType: COMPOUND
  subFunctions:
    m3u8:
      funcName: buildin.logical.copy
      target: m3u8
      inputRefs: []
    segments:
      funcName: buildin.hls.ts.transcode
      target: segments
      inputRefs: []
  additionalInputs: []
