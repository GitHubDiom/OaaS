- name: builtin.media.probe
  type: TASK
  reactive: true
  outputTemplate:
    type: RESOURCE
    labels: {}
    state:
      type: SEGMENTABLE
  bindingRequirement:
    requiredType: RESOURCE
    requiredStateType: SEGMENTABLE
  additionalInputs: []
  task:
    type: EPHEMERAL_WORKER
    #    image: jrottenberg/ffmpeg:4.4-alpine
    image: core.harbor.10.131.36.27.nip.io/oaas/ffmpeg
    commands:
      - /bin/sh
      - '-c'
    containerArgs:
      - |
        CMD="ffprobe $MAIN_RESOURCE_BASE_URL/$REQUEST_FILE >> tmp"
        echo "COMMAND: '$CMD'"
        $CMD
        CMD="curl -T tmp $OUTPUT_RESOURCE_BASE_URL/${REQUEST_FILE}.log"
        echo "COMMAND: '$CMD'"
        $CMD
    argsToEnv: true
